<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apex Match Logger</title>
<style>
  body { font-family: Arial, sans-serif; background: #121212; color: #fff; padding: 20px; }
  h1 { text-align: center; }
  label { display: block; margin-top: 10px; }
  input { width: 100%; padding: 8px; margin-top: 5px; border: none; border-radius: 5px; }
  button { margin-top: 15px; padding: 10px; border: none; background: #e53935; color: white; cursor: pointer; border-radius: 5px; width: 100%; }
  button:hover { background: #d32f2f; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #444; padding: 8px; text-align: center; }
  th { background: #222; }
  .stats { margin-top: 20px; background: #1e1e1e; padding: 15px; border-radius: 8px; }
  canvas { background: #1e1e1e; border-radius: 8px; padding: 10px; }
  .back-btn {
    display: inline-block;
    margin-bottom: 15px;
    padding: 8px 12px;
    background: #e53935;
    color: white;
    text-decoration: none;
    border-radius: 5px;
    font-weight: bold;
  }
  .back-btn:hover {
    background: #d32f2f;
  }
</style>
</head>
<body>

<a href="index.html" class="back-btn">â¬… ZurÃ¼ck zum Dashboard</a>

<h1>ðŸ”« Apex Match Logger</h1>

<label>Datum:</label>
<input type="date" id="date">
<label>Placement:</label>
<input type="number" id="placement" min="1" max="20">
<label>Kills:</label>
<input type="number" id="kills" min="0">
<label>Tode:</label>
<input type="number" id="deaths" min="0">
<label>Damage:</label>
<input type="number" id="damage" min="0">
<label>RP Gewinn/Verlust:</label>
<input type="number" id="rp" min="-500">

<button onclick="addMatch()">Match speichern</button>
<button onclick="exportCSV()">CSV exportieren</button>
<button onclick="resetLogger()">ZurÃ¼cksetzen</button>

<div class="stats">
  <p><strong>Durchschnitt Kills:</strong> <span id="avgKills">0</span></p>
  <p><strong>Durchschnitt Damage:</strong> <span id="avgDamage">0</span></p>
  <p><strong>Gesamt RP:</strong> <span id="totalRP">0</span></p>
  <p><strong>K/Dâ€‹-Quote:</strong> <span id="kdRatio">0</span></p>
  <p><strong>Durchschnittlicher RP-Gewinn:</strong> <span id="avgRP">0</span></p>
</div>

<canvas id="rpChart" height="100"></canvas>
<canvas id="kdChart" height="100"></canvas>
<canvas id="placementChart" height="100"></canvas>

<table id="matchTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Datum</th>
      <th>Placement</th>
      <th>Kills</th>
      <th>Tode</th>
      <th>Damage</th>
      <th>RP</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let matches = JSON.parse(localStorage.getItem('apexMatches')) || [];
let rpChart, kdChart, placementChart;

function updateStats() {
  if (matches.length === 0) {
    document.getElementById('avgKills').textContent = 0;
    document.getElementById('avgDamage').textContent = 0;
    document.getElementById('totalRP').textContent = 0;
    document.getElementById('kdRatio').textContent = 0;
    document.getElementById('avgRP').textContent = 0;
    return;
  }

  let totalKills = matches.reduce((sum, m) => sum + m.kills, 0);
  let totalDamage = matches.reduce((sum, m) => sum + m.damage, 0);
  let totalRP = matches.reduce((sum, m) => sum + m.rp, 0);
  let totalDeaths = matches.reduce((sum, m) => sum + m.deaths, 0);

  let avgKills = totalKills / matches.length;
  let avgDamage = totalDamage / matches.length;
  let avgRP = totalRP / matches.length;
  let kdRatio = totalDeaths > 0 ? (totalKills / totalDeaths).toFixed(2) : totalKills.toFixed(2);

  document.getElementById('avgKills').textContent = avgKills.toFixed(1);
  document.getElementById('avgDamage').textContent = avgDamage.toFixed(0);
  document.getElementById('totalRP').textContent = totalRP;
  document.getElementById('kdRatio').textContent = kdRatio;
  document.getElementById('avgRP').textContent = avgRP.toFixed(1);
}

function renderTable() {
  let tbody = document.querySelector("#matchTable tbody");
  tbody.innerHTML = "";
  matches.forEach((m, i) => {
    let row = `<tr>
      <td>${i + 1}</td>
      <td>${m.date || "-"}</td>
      <td>${m.placement}</td>
      <td>${m.kills}</td>
      <td>${m.deaths}</td>
      <td>${m.damage}</td>
      <td>${m.rp}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function renderCharts() {
  if (rpChart) rpChart.destroy();
  if (kdChart) kdChart.destroy();
  if (placementChart) placementChart.destroy();

  const labels = matches.map((m, i) => m.date || `Match ${i + 1}`);

  rpChart = new Chart(document.getElementById('rpChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'RP-Verlauf',
        data: matches.map(m => m.rp),
        borderColor: '#e53935',
        fill: false
      }]
    }
  });

  kdChart = new Chart(document.getElementById('kdChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'K/D-Verlauf',
        data: matches.map(m => m.deaths > 0 ? m.kills / m.deaths : m.kills),
        borderColor: '#29b6f6',
        fill: false
      }]
    }
  });

  const placementGroups = { '1-3': 0, '4-10': 0, '11-20': 0 };
  matches.forEach(m => {
    if (m.placement <= 3) placementGroups['1-3']++;
    else if (m.placement <= 10) placementGroups['4-10']++;
    else placementGroups['11-20']++;
  });

  placementChart = new Chart(document.getElementById('placementChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: Object.keys(placementGroups),
      datasets: [{
        label: 'Placement-Verteilung',
        data: Object.values(placementGroups),
        backgroundColor: ['#66bb6a', '#ffa726', '#ef5350']
      }]
    }
  });
}

function addMatch() {
  let date = document.getElementById('date').value;
  let placement = parseInt(document.getElementById('placement').value) || 0;
  let kills = parseInt(document.getElementById('kills').value) || 0;
  let deaths = parseInt(document.getElementById('deaths').value) || 0;
  let damage = parseInt(document.getElementById('damage').value) || 0;
  let rp = parseInt(document.getElementById('rp').value) || 0;

  matches.push({ date, placement, kills, deaths, damage, rp });
  localStorage.setItem('apexMatches', JSON.stringify(matches));

  updateStats();
  renderTable();
  renderCharts();
}

function exportCSV() {
  const header = ['Datum', 'Placement', 'Kills', 'Tode', 'Damage', 'RP'];
  const rows = matches.map(m => [m.date, m.placement, m.kills, m.deaths, m.damage, m.rp]);
  const csvContent = [header, ...rows].map(e => e.join(",")).join("\n");

  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "apex_match_log.csv";
  a.click();
}

function resetLogger() {
  if (!confirm("Willst du wirklich alle Matches lÃ¶schen?")) return;
  matches = [];
  localStorage.removeItem('apexMatches');
  updateStats();
  renderTable();
  renderCharts();
}

updateStats();
renderTable();
renderCharts();
</script>

</body>
</html>
